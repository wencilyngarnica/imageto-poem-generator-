<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <title>Poem Generator</title>

  <!-- Pico.css (WCAG-compliant) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">

  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
  <main class="container">

    <header>
      <h1>Poem Generator</h1>
      <p>Enter a description and generate a poem.</p>

      <button id="themeToggle" aria-label="Toggle dark mode">
        Toggle Dark / Light
      </button>
    </header>

    <form onsubmit="generatePoem(); return false;">

      <label for="description">Description</label>
      <textarea
        id="description"
        rows="4"
        required
        aria-required="true"
        placeholder="A lonely tree under the sunset...">
      </textarea>

      <label for="style">Poem Style</label>
      <select id="style">
        <option value="free">Free Verse</option>
        <option value="sad">Sad</option>
        <option value="love">Love</option>
        <option value="nature">Nature</option>
        <option value="haiku">Haiku</option>
      </select>

      <button type="submit">Generate Poem</button>

      <label for="poem">Generated Poem</label>
      <textarea
        id="poem"
        rows="7"
        readonly
        aria-live="polite">
      </textarea>

      <button type="button" onclick="copyPoem()">Copy</button>
      <button type="button" onclick="savePoem()">Save</button>

    </form>

  </main>

<script>
  async function generatePoem() {
    const description = document.getElementById("description").value;
    const style = document.getElementById("style").value;
    const poemBox = document.getElementById("poem");

    poemBox.value = "Generating poem...";

    const prompt = `
Create a ${style} poem.
${description}
`;

    try {
      const response = await fetch("http://localhost:11434/api/generate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          model: "tinyllama-poem-only",
          prompt: prompt,
          stream: false
        })
      });

      const data = await response.json();
      poemBox.value = data.response.trim();

    } catch (e) {
      poemBox.value = "Error: Ollama / TinyLlama is not running.";
    }
  }

  function copyPoem() {
    navigator.clipboard.writeText(
      document.getElementById("poem").value
    );
    alert("Poem copied.");
  }

  function savePoem() {
    const text = document.getElementById("poem").value;
    const blob = new Blob([text], { type: "text/plain" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "poem.txt";
    a.click();
  }

  // REAL dark mode toggle (WCAG)
  document.getElementById("themeToggle").onclick = () => {
    const html = document.documentElement;
    html.dataset.theme =
      html.dataset.theme === "dark" ? "light" : "dark";
  };
</script>

</body>
</html>
